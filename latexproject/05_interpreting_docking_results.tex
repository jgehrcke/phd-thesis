\chapter{Interpreting docking results: docking solution ensemble clustering}

In this chapter we describe why the conduction of a meaningful docking study
requires proper creation and analysis of an ensemble of docking solutions and
explain why clustering is an essential step for making reasonable predictions
about where and how a ligand binds to its receptor. This topic is unfortunately
not well discussed in current molecular docking literature, and existing
technical implementations for the clustering of docking solutions often do not
fit the scientific question and therefore may produce misleading results. Here,
we present a method optimized for clustering docking solution ensembles of GAG
molecules.

\section{Relevance of docking solution clustering}

In the framework of this thesis the term \enquote{docking solution} shall be
understood as a set of ligand atom coordinates, i.e.\ the spatial arrangement of
ligand atoms in the reference coordinate system as defined by the receptor
molecule. As a result of the statistical nature of the docking problem and the
use of pseudo random numbers in implementations of common docking search
algorithms, independent runs of the same docking method are expected to produce
different docking solutions. That is why for seeing the full picture, a
molecular docking method should be applied repetitively, resulting in an
ensemble of docking solutions.

The spatial distribution of docking solutions in that ensemble is governed by a
certain previously unknown probability distribution, which itself is implicitly
determined by the molecular interaction model and search algorithm implemented
in the docking method. Given that we trust the molecular interaction model, the
ultimate goal of a docking study is to obtain the global maximum (and/or some
local maxima) of the named probability distribution. Concept-wise, this is
equivalent to searching the state with highest probability, i.e. lowest energy.
Obtaining local maxima requires complete sampling of that unknown probability
distribution. That is why a docking method must be repeated until convergence
in the spatial distribution of the docking solutions is achieved. Only then the
ensemble reproduces the previously unknown probability distribution and reflects
the molecular interaction model as implemented by the docking method.

If convergence is observed, the next step is to identify the local maxima in the
spatial probability distribution of docking solutions. This problem can be
reformulated in terms of density, i.e.\ as finding the densest agglomerations of
docking solutions in the ensemble. However, a simple evaluation of the
distribution of atoms or molecules per volume would not provide useful results,
because a ligand molecule is comprised of multiple different atoms and has
various asymmetries with respect to shape and property. Spoken freely, the task
is to find agglomerations of docking solutions that are highly \textit{similar}
to each other. Hence, a promising approach is to evaluate the density in terms
of the \textit{similarity} between any two given docking solutions in the
ensemble, subject to the condition that a meaningful molecular similarity
measure can be found. In an abstract sense, the task is to identify groups of
highly similar docking solutions and to separate them from the bulk. This task
fits the general description of \textit{data clustering} as found in
\cite{tan_data_mining}:

\begin{adjustwidth}{1.5cm}{1.5cm}
\textit{\enquote{
The goal is that the objects within a group be similar to one another and
different from the objects in other groups. The greater the similarity (or
homogeneity) within a group and the greater the difference between groups, the
better or more distinct the clustering.}}
\end{adjustwidth}

In conclusion, the most probable ligand molecule placement as predicted by a
certain docking method can be found by \textit{meaningful} clustering of the
converged ensemble of docking solutions. Meaningful clustering can be achieved
by selecting a problem-adjusted clustering method, whereas any data clustering
method has only two major components:

\begin{itemize}
\item the \textit{distance metric}, quantifying the similarity between any two
given objects.
\item a \textit{clustering algorithm}, classifying the objects into groups
(clusters), based on their mutual similarity (i.e.\ distance).
\end{itemize}

It is important to appreciate that both components must be adjusted to the
scientific question, otherwise the result of docking solution clustering might
be meaningless and/or incomparable to other docking studies. Within the next
sections, we introduce a distance metric optimized for GAG molecules and
describe a clustering algorithm appropriate for clustering molecular structure
ensembles in general.


\section{A meaningful distance metric for GAG molecules}

As clarified above, spatial clustering evaluates distances between data points
rather than data points themselves and the distance metric used for calculation
of the similarity between two molecular structures must be properly adjusted to
the scientific aim.

The two standard choices, classical $RMSd$ (root mean square deviation with identity-based atomic matching) as distance metric


Thus, we define a distance metric $\delta$ as the root mean
square of pairwise atomic distances while pairing up spatially closest atoms of
the same type. This distance metric accounts for periodicity of functional
groups in GAGs and considers two GAGs shifted by $n$ periodic units as
structurally similar, while classical $RMSd$ with identity-based matching
ignores this characteristic.

\lipsum[1-2]


\section{Algorithm of choice: DBSCAN}

\lipsum[1-2]

From literature, I identified the DBSCAN algorithm \cite{dbscanref} to be
appropriate for clustering molecular structures. In contrast to the otherwise
well-established hierarchical clustering, it does not depend on an arbitrarily
defined inter-cluster distance.

At the time of developing the method, according to literature, we were the first
ones implementing DBSCAN for clustering molecular structures. In the meantime,
DBSCAN has also been implemented in cpptraj, a general purpose tool for
analyzing molecular dynamics trajectories.

\subsection{Clustering method overview}

Compared to standard clustering methods, these ingredients significantly
increase the interpretability of GAG docking results and enhance their
comparability. I implemented DBSCAN as well as the optimized distance metric
using linear algebra methods and multi-core software technology. The improved
approach has become standard procedure in the Pisabarro research group and was
used in published work \cite{franz_cathepsin_2013}.


    - Clustering methods overview
        hierarchical clustering implemented in AutoDockTools
            badly implemented, due to $N^2$ dependence very long runtimes
        other methods, quick
        DBSCAN, explain why it makes sense for molecular structures
        cite cpptraj, which also started implementing it

\subsection{DBSCAN parameter optimization}

    - change criteria from eps/minp to N clusters / members
    - reproducibility!
    - comparability among studies
    - characterization of a cluster via eps


\section{Clustering method implementation}

\subsection{Efficient implementation of DBSCAN for numpy}

        - Custom implementation of the DBSCAN algorithm

\subsection{Efficient implementation of RMSatd for numpy}

        - Custom implementation of the DBSCAN algorithm
        - examples
            http://scikit-learn.org/stable/modules/clustering.html
            http://bit.ly/1pKNv7v


\subsection{Parameter optimization}

        - brute force plus local optimization

\subsection{Architecture of cluster-pdb-structures}

            command line tool, simple PDB parser files
            distance matrix calculation on multiple cores via Unix fork()

            input: structure ensemble, DBSCANopt parameters
            output: structure files, stat summary


            open source at bitbucket..


